---
layout: post
title: Beware Of param() Or How Perl Is So Quirky It Hurts
date: '2018-03-21T03:55:00.000-07:00'
author: Hland
tags: 
modified_time: '2018-03-21T03:55:24.263-07:00'
blogger_id: tag:blogger.com,1999:blog-3264165303439231899.post-4836360787789471467
blogger_orig_url: https://blankhat.blogspot.com/2018/03/beware-of-param-or-how-perl-is-so.html
---

Recently I had the pleasure of testing and code reviewing a Perl application. Perl is a programming language in its prime at 28 years old. Originally made to help programmers do complex report processing more efficiently, it evolved and became a language for the web. It often ties together classic programs that ran on shared servers with a web server making them available from a browser to everyone connected to the Internet. And despite all the new technologies making web programming easier there are still plenty of Perl out there on the Interwebz and a lot of old-timers (sorry guys) that churn out Perl code.<br /><br />Like most program languages it has some interesting quirks that makes exploitation possible in certain situations. In this post I'll show how -&gt;param() can be abused to do e.g. SQL injection on a seemingly secure parameterized query.<br /><br />Due to my lack of Perl competence I don't have a full overview of the different Perl packages containing this function but I have encountered it in two different<br /><br />Perl CGI Documentation:<br />http://search.cpan.org/~leejo/CGI-4.38/lib/CGI.pod<br /><br /><blockquote class="tr_bq" style="background-color: white; font-family: arial, sans-serif;"><b>Warning</b>&nbsp;- calling param() in list context can lead to vulnerabilities if you do not sanitise user input as it is possible to inject other param keys and values into your code. This is why the multi_param() method exists, to make it clear that a list is being returned, note that param() can still be called in list context and will return a list for back compatibility.</blockquote><div><br /></div><b>PSGI/Plack:</b><br /><br /><script src="https://gist.github.com/chrihala/6c4496d6974d221e917cd831c6767214.js"></script>The Plack Request object documentation:<br /><a href="http://search.cpan.org/~miyagawa/Plack-1.0042/lib/Plack/Request.pm">http://search.cpan.org/~miyagawa/Plack-1.0042/lib/Plack/Request.pm</a><br /><br /><br /><br />By going to the documentation and searching for "misuse" we find that using the param() method isn't recommended because it can be abused when used inside of a hash constructor or method arguments.<br /><br /><blockquote class="tr_bq"><div style="background-color: white; font-family: arial, sans-serif;">You are&nbsp;<b>not recommended</b>&nbsp;to use this method since it is easy to misuse in a list context such as inside a hash constructor or method arguments. Use&nbsp;<code>parameters</code>&nbsp;and Hash::MultiValue instead.</div><div><br /></div></blockquote><br class="Apple-interchange-newline" />The problem is that this function is context-sensitive. Use it to parse a query string parameter into a scalar variable and it works as expected; it returns the value of the query string and stores it in the variable:<br /><br />example.com?id=123<br /><br />my $id = $cgi-&gt;param('id')<br /><br />However, if it is used inside of a hash constructor, like this:<br /><br />my&nbsp;@<br /><br />example.com?id=123&amp;id=456&amp;id=789<br /><br />Ends up looking like<br /><br />{<br />'id' =&gt; '123',<br />'456' =&gt; '789',<br />}<br /><div><br /></div><br />What this means for us is that we can make a request to the vulnerable application that looks like the following:<br /><br /><br />https://blog.gerv.net/2014/10/new-class-of-vulnerability-in-perl-web-applications/<br /><br />This is not a new vulnerability and it has been known for a long time, it's just that not every developer knowns about this pitfall and so new vulnerable code is written.<br />http://seclists.org/vulnwatch/2006/q4/6<br /><br /><br /><script src="https://gist.github.com/chrihala/ee1a4d74951bab89c2c764f6ade3e200.js"></script> 